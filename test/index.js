var path = require('path');
var fs = require('fs');
var tester = require('gitbook-tester');
var assert = require('assert');
var plugin = require('../lib/puml.js');

describe('PlantUML', function() {
    
    it('should correctly find the path to the jar file', function() {
        var regex = /plantuml\.[0-9]*\.jar$/;
        assert.equal(true,regex.test(plugin.getPlantUMLJarPath()));
    });

    it('should have UML data written to temp file', function() {
        assert.equal(plugin.writeUMLDataToTempFile("\nBob->Alice : hello\n"),true);
    });

    it('should return the PNG UML', function() {
        assert.equal(plugin.getPlantUMLOutput("png","\nBob->Alice : hello\n"),'<img src="data:image/png;base64,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">');
    });

    it('should correctly replace by img html tag', function() {
        return tester.builder()
            .withContent('This is a diagram:\n\n{% plantuml %}\nBob->Alice : hello\n{% endplantuml %}')
            .withBookJson({
                plugins: ['puml']
            })
            .withLocalPlugin(path.join(__dirname, '..'))
            .create()
            .then(function(result) {
                assert.equal(result[0].content, '<p>This is a diagram:</p>\n<p><img src="data:image/png;base64,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"></p>');
            });
    });
});
